var Z=Object.defineProperty,ee=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var I=(s,e,t)=>e in s?Z(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,V=(s,e)=>{for(var t in e||(e={}))se.call(e,t)&&I(s,t,e[t]);if(A)for(var t of A(e))ae.call(e,t)&&I(s,t,e[t]);return s},F=(s,e)=>ee(s,te(e));var T=(s,e,t)=>new Promise((r,p)=>{var d=n=>{try{a(t.next(n))}catch(c){p(c)}},u=n=>{try{a(t.throw(n))}catch(c){p(c)}},a=n=>n.done?r(n.value):Promise.resolve(n.value).then(d,u);a((t=t.apply(s,e)).next())});import{aC as oe,aD as ne,aU as le,aw as re,ao as K,i as ce,az as G,b1 as $,c as M,a4 as ie,G as q,b3 as ue,b6 as de,aB as j,bX as pe,bb as w,g as he,b2 as me,cu as ve,c2 as W,o as S,a as C,f as B,D as X,v as x,C as O,_ as fe,h as ye,j as ge,k as _e,cl as be,O as xe,q as Se,e as g,F as ke,x as we,ah as Me,cG as Pe,z as Ce,ae as Oe,A as N,d as D,b as L}from"./bundle.0.0.2.js?v=0.6036900755232442";import{i as Te}from"./chunk.4zk24.js";import{v as Ne}from"./chunk.4zk41.js";import{p as Le,N as Re,f as E}from"./chunk.4zk23.js";import{i as je,a as Be,N as Ue,m as H}from"./chunk.4zk50.js";import{c as $e,h as R}from"./chunk.4zk34.js";import{c as ze}from"./chunk.4zk35.js";import{N as U}from"./chunk.4zk31.js";import"./chunk.4zk39.js";function Ae(s){const{boxShadow2:e}=s;return{menuBoxShadow:e}}const Ie=oe({name:"Popselect",common:ne,peers:{Popover:Le,InternalSelectMenu:je},self:Ae}),J=Ie,Y=le("n-popselect"),Ve=re("popselect-menu",`
 box-shadow: var(--n-menu-box-shadow);
`),z={multiple:Boolean,value:{type:[String,Number,Array],default:null},cancelable:Boolean,options:{type:Array,default:()=>[]},size:{type:String,default:"medium"},scrollable:Boolean,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onMouseenter:Function,onMouseleave:Function,renderLabel:Function,showCheckmark:{type:Boolean,default:void 0},nodeProps:Function,virtualScroll:Boolean,onChange:[Function,Array]},Q=pe(z),Fe=K({name:"PopselectPanel",props:z,setup(s){const e=ce(Y),{mergedClsPrefixRef:t,inlineThemeDisabled:r}=G(s),p=$("Popselect","-pop-select",Ve,J,e.props,t),d=M(()=>$e(s.options,Be("value","children")));function u(l,f){const{onUpdateValue:h,"onUpdate:value":m,onChange:y}=s;h&&w(h,l,f),m&&w(m,l,f),y&&w(y,l,f)}function a(l){c(l.key)}function n(l){!R(l,"action")&&!R(l,"empty")&&!R(l,"header")&&l.preventDefault()}function c(l){const{value:{getNode:f}}=d;if(s.multiple)if(Array.isArray(s.value)){const h=[],m=[];let y=!0;s.value.forEach(v=>{if(v===l){y=!1;return}const i=f(v);i&&(h.push(i.key),m.push(i.rawNode))}),y&&(h.push(l),m.push(f(l).rawNode)),u(h,m)}else{const h=f(l);h&&u([l],[h.rawNode])}else if(s.value===l&&s.cancelable)u(null,null);else{const h=f(l);h&&u(l,h.rawNode);const{"onUpdate:show":m,onUpdateShow:y}=e.props;m&&w(m,!1),y&&w(y,!1),e.setShow(!1)}q(()=>{e.syncPosition()})}ie(ue(s,"options"),()=>{q(()=>{e.syncPosition()})});const P=M(()=>{const{self:{menuBoxShadow:l}}=p.value;return{"--n-menu-box-shadow":l}}),_=r?de("select",void 0,P,e.props):void 0;return{mergedTheme:e.mergedThemeRef,mergedClsPrefix:t,treeMate:d,handleToggle:a,handleMenuMousedown:n,cssVars:r?void 0:P,themeClass:_==null?void 0:_.themeClass,onRender:_==null?void 0:_.onRender}},render(){var s;return(s=this.onRender)===null||s===void 0||s.call(this),j(Ue,{clsPrefix:this.mergedClsPrefix,focusable:!0,nodeProps:this.nodeProps,class:[`${this.mergedClsPrefix}-popselect-menu`,this.themeClass],style:this.cssVars,theme:this.mergedTheme.peers.InternalSelectMenu,themeOverrides:this.mergedTheme.peerOverrides.InternalSelectMenu,multiple:this.multiple,treeMate:this.treeMate,size:this.size,value:this.value,virtualScroll:this.virtualScroll,scrollable:this.scrollable,renderLabel:this.renderLabel,onToggle:this.handleToggle,onMouseenter:this.onMouseenter,onMouseleave:this.onMouseenter,onMousedown:this.handleMenuMousedown,showCheckmark:this.showCheckmark},{header:()=>{var e,t;return((t=(e=this.$slots).header)===null||t===void 0?void 0:t.call(e))||[]},action:()=>{var e,t;return((t=(e=this.$slots).action)===null||t===void 0?void 0:t.call(e))||[]},empty:()=>{var e,t;return((t=(e=this.$slots).empty)===null||t===void 0?void 0:t.call(e))||[]}})}}),qe=Object.assign(Object.assign(Object.assign(Object.assign({},$.props),W(E,["showArrow","arrow"])),{placement:Object.assign(Object.assign({},E.placement),{default:"bottom"}),trigger:{type:String,default:"hover"}}),z),De=K({name:"Popselect",props:qe,slots:Object,inheritAttrs:!1,__popover__:!0,setup(s){const{mergedClsPrefixRef:e}=G(s),t=$("Popselect","-popselect",void 0,J,s,e),r=he(null);function p(){var a;(a=r.value)===null||a===void 0||a.syncPosition()}function d(a){var n;(n=r.value)===null||n===void 0||n.setShow(a)}return me(Y,{props:s,mergedThemeRef:t,syncPosition:p,setShow:d}),Object.assign(Object.assign({},{syncPosition:p,setShow:d}),{popoverInstRef:r,mergedTheme:t})},render(){const{mergedTheme:s}=this,e={theme:s.peers.Popover,themeOverrides:s.peerOverrides.Popover,builtinThemeOverrides:{padding:"0"},ref:"popoverInstRef",internalRenderBody:(t,r,p,d,u)=>{const{$attrs:a}=this;return j(Fe,Object.assign({},a,{class:[a.class,t],style:[a.style,...p]},ve(this.$props,Q),{ref:ze(r),onMouseenter:H([d,a.onMouseenter]),onMouseleave:H([u,a.onMouseleave])}),{header:()=>{var n,c;return(c=(n=this.$slots).header)===null||c===void 0?void 0:c.call(n)},action:()=>{var n,c;return(c=(n=this.$slots).action)===null||c===void 0?void 0:c.call(n)},empty:()=>{var n,c;return(c=(n=this.$slots).empty)===null||c===void 0?void 0:c.call(n)}})}};return j(Re,Object.assign({},W(this.$props,Q),e,{internalDeactivateImmediately:!0}),{trigger:()=>{var t,r;return(r=(t=this.$slots).default)===null||r===void 0?void 0:r.call(t)}})}});const Ee={class:"SelectComp"},He={__name:"SelectComp",props:{options:{type:Object,default:()=>[]},style:{type:Object,default:()=>{}},placeholder:{type:String,default:""},maxlength:{type:String,default:""},value:{type:String,default:""}},emits:["update:value"],setup(s,{emit:e}){const t=s,r=e;return(p,d)=>(S(),C("div",Ee,[B(x(De),{trigger:"click","arrow-wrapper-class":"SelectComp",value:t.value,onChange:d[1]||(d[1]=u=>r("update:value",u)),options:s.options,size:"medium",scrollable:""},{default:X(()=>[B(x(U),{style:O(t.style),value:t.value,maxlength:t.maxlength,onInput:d[0]||(d[0]=u=>r("update:value",u)),placeholder:t.placeholder},null,8,["style","value","maxlength","placeholder"])]),_:1},8,["value","options"])]))}};const Qe={class:"edit_schema tpage"},Ke={class:"topbar flex_b flex_sx_center"},Ge={class:"right"},We={class:"form"},Xe={class:"label flex_b"},Je={class:"lable_text"},Ye={key:0,class:"lable_right"},Ze={class:"value"},et={__name:"index",setup(s){let e=!1;const t=ye(),r=ge(),p=_e(),d=be(),u=M(()=>t.query.id);M(()=>t.query.type);const a=xe({name:"",sqlType:"",schema:""}),n=Object.assign(Te,{fontSize:"var(--tp_size)",lineHeight:"50px","--n-border":"none","--n-border-hover":"none","--n-border-focus":"none",backgroundColor:"var(--tp_footer_bgcolor)","--n-border-radius":"0px","--n-border-disabled":"none"}),c=["MySQL","Oracle","SQL Server","PostgreSQL","MariaDB"],P=M(()=>c.map(v=>({label:v,value:v}))),_=[{type:"input",label:"表结构名称",maxLength:"32",key:"name",placeholder:"请填写32字已便于自己识别的表结构名称"},{type:"select",maxLength:"32",label:"语言类型",placeholder:"请选择语言类型",key:"sqlType"},{type:"textarea",label:"表结构信息",key:"schema",maxLength:"8192",autosize:{minRows:10,maxRows:10},placeholder:'请填写表结构信息，字段越详细越好。MySQL里可以直接使用 "SHOW CREATE TABLE table_name" 来获取表的信息'}],l=()=>{if(!u.value)return;const{name:v,sqlType:i,schema:o}=d.getSchema(u.value)||{};Object.assign(a,{name:v,sqlType:i,schema:o})},f={name:[{type:"empty",message:"请填写表结构名称"}],sqlType:[{type:"empty",message:"请选择语言类型"}],schema:[{type:"empty",message:"请填写表结构信息"}]},h=()=>T(this,null,function*(){const v=Object.entries(f).map(([i,o])=>({key:i,rules:o}));for(let i=0;i<v.length;i++){const{key:o,rules:k}=v[i],b=yield Ne(a[o],k);if(b)return{err:!0,errMsg:b}}return{err:!1,data:a}}),m=()=>{e||(e=!0,Me(r,{name:"sqlchat"}),e=!1)},y=()=>T(this,null,function*(){if(e)return;e=!0;const{err:v,errMsg:i,data:o}=yield h();if(i){e=!1,p.error(i);return}const{errMsg:k}=yield Pe(F(V({},a),{id:u.value}));if(k){e=!1,p.error(k);return}p.success(u.value?"保存成功":"添加成功"),e=!1,m()});return Se(()=>{l()}),(v,i)=>(S(),C("div",Qe,[g("div",Ke,[g("div",{class:"flex_sx_center back hover_bg",tabindex:"0",onClick:m},i[0]||(i[0]=[g("span",{class:"text"},"取消",-1)])),g("div",Ge,[B(x(Oe),{block:"",type:"info",class:"btn",onClick:y},{default:X(()=>i[1]||(i[1]=[Ce("保存")])),_:1})])]),g("div",We,[(S(),C(ke,null,we(_,(o,k)=>g("div",{class:"row",key:k},[g("div",Xe,[g("div",Je,N(o.label),1),o.maxLength?(S(),C("div",Ye,N(a[o.key].length)+" / "+N(o.maxLength),1)):D("",!0)]),g("div",Ze,[o.type==="input"?(S(),L(x(U),{key:0,maxlength:o.maxLength,value:a[o.key],"onUpdate:value":b=>a[o.key]=b,style:O(x(n)),placeholder:o.placeholder},null,8,["maxlength","value","onUpdate:value","style","placeholder"])):o.type==="textarea"?(S(),L(x(U),{key:1,type:"textarea",autosize:o.autosize,maxlength:o.maxLength,value:a[o.key],"onUpdate:value":b=>a[o.key]=b,style:O(x(n)),placeholder:o.placeholder},null,8,["autosize","maxlength","value","onUpdate:value","style","placeholder"])):o.type==="select"?(S(),L(He,{key:2,options:P.value,style:O(x(n)),maxlength:o.maxLength,placeholder:o.placeholder,value:a[o.key],"onUpdate:value":b=>a[o.key]=b},null,8,["options","style","maxlength","placeholder","value","onUpdate:value"])):D("",!0)])])),64))])]))}},dt=fe(et,[["__scopeId","data-v-41038d2c"]]);export{dt as default};
