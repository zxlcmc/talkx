var U=Object.defineProperty,V=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var z=(r,e,s)=>e in r?U(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s,k=(r,e)=>{for(var s in e||(e={}))$.call(e,s)&&z(r,s,e[s]);if(M)for(var s of M(e))G.call(e,s)&&z(r,s,e[s]);return r},N=(r,e)=>V(r,A(e));var S=(r,e,s)=>new Promise((u,v)=>{var y=t=>{try{p(s.next(t))}catch(f){v(f)}},x=t=>{try{p(s.throw(t))}catch(f){v(f)}},p=t=>t.done?u(t.value):Promise.resolve(t.value).then(y,x);p((s=s.apply(r,e)).next())});import{_ as O,g as _,h as W,m as J,n as K,O as Q,c as X,q as Y,G as E,t as Z,o as m,a as g,e as d,f as H,D as B,v as T,F as b,x as j,d as P,C as ee,P as se,cW as te,b as oe}from"./bundle.0.0.2.js?v=0.6036900755232442";import{H as ne}from"./chunk.4zk20.js";import{M as re}from"./chunk.4zk26.js";import{u as ae}from"./chunk.4zk32.js";import{N as le}from"./chunk.4zk23.js";import"./chunk.4zk21.js";import"./chunk.4zk22.js";import"./chunk.4zk36.js";import"./chunk.4zk37.js";import"./chunk.4zk38.js";const ie={class:"share"},ce={class:"right"},de={class:"content"},ue={key:1,class:"loading"},pe={key:2,class:"nolink"},me={__name:"index",setup(r){const e=_([]),s=W(),u=_(!1);let v=_(!1);const y=J(),x=K(),p=Q({current:1,size:50});console.log("instance",x.root);const t=_(),{scolllDom:f,wrapperH:ve,scroll:C,addScrollFun:R}=ae({listDom:t,type:"top"}),D=_("100%"),h=X(()=>{var a=[],o=-1;const l=e.value;let i="";return l.forEach((n,c)=>{(l[i]&&l[i].role==n.role||!l[i]||n.role==="user")&&(o++,a[o]||(a[o]={chat:[]})),i=c,a[o].chat.push(N(k({},n),{__index:c}))}),a=a.map(n=>(n.chat.find(c=>c.role=="user")||n.chat.unshift({id:Math.random(),role:"user",sessionId:"",content:""}),n.chat.find(c=>c.role=="assistant")||n.chat.push({id:Math.random(),role:"assistant",sessionId:"",content:""}),n)),a}),I=()=>S(this,null,function*(){if(!u.value){u.value=!0;try{const{current:a,pages:o,records:l,total:i}=yield se(k({sessionId:s.params.uid},p)),n=e.value[0];let c=0;n&&(c=document.querySelector(`[msg-id="${n.id}"]`).offsetTop),e.value.unshift(...l.reverse()),v.value=a>=o||e.value.length>=i,n&&E(()=>{const L=document.querySelector(`[msg-id="${n.id}"]`);t.value.scrollTop=t.value.scrollTop+(L.offsetTop-c)})}catch(a){console.log("err",a)}finally{u.value=!1}}}),w=()=>{D.value=te()?"100%":"600px"},q=()=>{u.value||v.value||(p.current++,I())};Y(()=>S(this,null,function*(){R(q),window.addEventListener("resize",w),w(),yield I(),E(()=>{t.value&&(t.value.scrollTop=t.value.scrollHeight)})})),Z(()=>window.removeEventListener("resize",w));const F=()=>{window.open(y.getShareUrl(s.params.inviteCode))};return(a,o)=>(m(),g("div",ie,[d("div",{class:"warpper tpage",style:ee({width:D.value})},[H(ne,null,{right:B(()=>[d("div",ce,[d("span",{onClick:F},"免费使用"),H(T(le),{trigger:"hover",raw:""},{trigger:B(()=>o[1]||(o[1]=[d("span",{class:"iconfont icon-info-circle"},null,-1)])),default:B(()=>[o[2]||(o[2]=d("div",{class:"right_tip"}," 此页面为用户与AI对话内容的分享，仅供参考，不代表任何个人、机构或公司观点。对话不构成专业建议，并概不负责对话信息带来的损失。对话内容可能随时变更、修改或删除。使用者需谨慎参考、寻求专业意见。 ",-1))]),_:1})])]),_:1}),d("div",de,[h.value.length?(m(),g("div",{key:0,class:"message_wrapper",id:"scrollRef",ref_key:"scrollRef",ref:t,onScrollPassive:o[0]||(o[0]=(...l)=>T(C)&&T(C)(...l))},[d("div",{class:"message_ul",ref_key:"scolllDom",ref:f},[(m(!0),g(b,null,j(h.value,(l,i)=>(m(),oe(re,{key:i,item:l,sending:!1,type:"share",end:i==h.value.length-1},null,8,["item","end"]))),128))],512)],544)):P("",!0),u.value?(m(),g("div",ue,"正在加载话题消息")):!u.value&&!h.value.length.length?(m(),g("div",pe,o[3]||(o[3]=[d("span",{class:"iconfont icon-lianjieshixiao"},null,-1),d("div",null,"抱歉，你当前浏览的话题已失效或不存在。",-1)]))):P("",!0)])],4)]))}},Ce=O(me,[["__scopeId","data-v-3d32e103"]]);export{Ce as default};
