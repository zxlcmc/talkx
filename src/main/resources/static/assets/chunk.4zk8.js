var L=Object.defineProperty,N=Object.defineProperties;var I=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var E=(e,t,o)=>t in e?L(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,B=(e,t)=>{for(var o in t||(t={}))V.call(t,o)&&E(e,o,t[o]);if(w)for(var o of w(t))H.call(t,o)&&E(e,o,t[o]);return e},T=(e,t)=>N(e,I(t));var g=(e,t,o)=>new Promise((c,a)=>{var s=i=>{try{r(o.next(i))}catch(l){a(l)}},n=i=>{try{r(o.throw(i))}catch(l){a(l)}},r=i=>i.done?c(i.value):Promise.resolve(i.value).then(s,n);r((o=o.apply(e,t)).next())});import{_ as _export_sfc,k as useMessage,g as ref,aq as getImgWH$1,c as computed,ar as optimizeKatex,q as onMounted,t as onUnmounted,o as openBlock,a as createElementBlock,e as createBaseVNode,as as separate_symbol,at as v4,an as __vitePreload,i as inject,A as toDisplayString,v as unref,aj as format,f as createVNode,p as useToast,j as useRouter,O as reactive,F as Fragment,x as renderList,d as createCommentVNode,ah as routerBack}from"./bundle.0.0.2.js?v=0.6036900755232442";import{a as favoritesList,d as delFavorites}from"./chunk.4zk30.js";import{u as useScrollBottom}from"./chunk.4zk32.js";import{c as copyToClip}from"./chunk.4zk38.js";import{H as HighlightJS,P as PhotoSwipeLightbox,i as init}from"./chunk.4zk36.js";import{M as MarkdownIt,m as mila,a as mdKatex}from"./chunk.4zk37.js";const TextComp_vue_vue_type_style_index_0_lang="",TextComp_vue_vue_type_style_index_1_scoped_27944a80_lang="",_hoisted_1$2=["id"],_hoisted_2$2=["innerHTML"],_sfc_main$2={__name:"TextComp",props:{text:{type:String,default:""},data:{type:Object,default:()=>({})},cursor:Boolean},setup(__props){const echartOptions=[],message=useMessage(),props=__props,textRef=ref(null);function highlightBlock(e,t,o,{code:c}){const a=t==="echarts";let s={};o&&o.split(separate_symbol).reduce((l,d)=>{const[m,p]=d.split(":");return l[m]=p,l},s);const n='style="display:inline"';let r=v4();a&&echartOptions.push({id:r,show:!1,options:c});const i=[];return s.fileName||i.push(`<span class="code-block-header__lang">${t||""}</span>`),i.push('<span class="block code-block-header__copy iconfont icon-file-copy" title="复制"></span>'),a&&i.push(`<span ${n} class="block code-block-header__echart iconfont icon-chart-pie" eid="${r}" title="显示图表"></span>`),s.fileName&&i.push(`<span class="code-block-header__fileName">${s.fileName||""} ${s.line||""}</span>`),i.push('<span class="code-block-header__unfold">隐藏</span>'),`<pre class="code-block-wrapper">
		<div class="code-block-header answer"> 
           ${i.join("")}
        </div>
        <code class="hljs code-block-body ${t}">${e}</code>
        ${a?`<div class="code_echarts_wrapper" eid="${r}" ></div>`:""} 
    </pre>`}const mdi=new MarkdownIt({html:!1,linkify:!0,highlight(e,t,o){if(!!(t&&HighlightJS.getLanguage(t))){const s=t!=null?t:"";return highlightBlock(HighlightJS.highlight(e,{language:s}).value,s,o,{code:e})}const a=HighlightJS.highlightAuto(e).value;return highlightBlock(a,t,void 0,{code:e})}});let isImage=!1;mdi.renderer.rules.image=function(e,t,o,c,a){const s=e[t].attrs[e[t].attrIndex("src")][1],n=e[t].content;isImage=!0;let r="";const i=getImgWH$1(s);if(!(i instanceof Promise)){const{width:l,height:d}=i;r=`data-pswp-width="${l}" data-pswp-height="${d}"`}return`<div class="gallery__item" url="${s}">
      <a class="md_img" href="${s}" target="_blank" rel="noreferrer" ${r} >
      <img src="${s}?image_process=resize,w_150"  alt="${n}" />
    </a>
  </div>`},mdi.use(mila,{attrs:{target:"_blank",rel:"noopener"}}),mdi.use(mdKatex,{blockClass:"katexmath-block rounded-md p-[10px]",errorColor:" #cc0000"});const preUnify=e=>{const t=document.createElement("div");t.innerHTML=e;const o=t.querySelectorAll("pre");return Array.from(o).forEach(c=>{if(!c.className.includes("code-block-wrapper")){const n="```\n"+c.querySelector("code").innerText+"```";c.outerHTML=mdi.render(n)}}),t.innerHTML};let showTimer;const text=computed(()=>{var o;echartOptions.length=0;let e=(o=props.text)!=null?o:"";e=optimizeKatex(e);const t="P_P_P_P";return props.cursor&&(e+=t),props.asRawText||(e=mdi.render(e)),e=e.replace(t,'<span class="text_cursor"></span>'),e=preUnify(e),console.log("xxxxxx"),clearTimeout(showTimer),showTimer=setTimeout(()=>{if(textRef.value){const c=textRef.value.querySelectorAll(".code-block-header__echart");Array.from(c).forEach(a=>a&&a.click())}},100),e}),copyEvent=function(e){var c,a;const o=(a=(c=e.target.parentElement)==null?void 0:c.nextElementSibling)==null?void 0:a.textContent;o&&copyToClip(o.trim()).then(()=>message.success("复制成功"))},unfoldEvent=function(e){var a,s;const t=e.target,o=(a=t.parentElement)==null?void 0:a.nextElementSibling,c=(s=t.parentElement)==null?void 0:s.parentElement;if(o){const n=t.textContent=="显示";t.textContent=n?"隐藏":"显示",o.classList[n?"remove":"add"]("hide"),c.style.overflow=n?"auto":"hidden"}},showEchart=(item,dom,hideChart)=>{try{item.chart||(item.chart=init(dom));let config=Object.assign({grid:{left:"20",right:"20",bottom:"20",containLabel:!0}},eval("("+item.options+")"));item.chart.setOption(config,!0)}catch(e){console.log("err",e),item.chart=null,console.log("options",item.options),hideChart()}},echartControl=e=>{var r,i,l;const t=e.target,o=t.getAttribute("eid"),c=(r=t.parentElement)==null?void 0:r.nextElementSibling,a=(l=(i=t.parentElement)==null?void 0:i.nextElementSibling)==null?void 0:l.nextElementSibling,s=echartOptions.find(d=>d.id==o),n=[{icon:"icon-chart-pie",title:"显示图表"},{icon:"icon-code",title:"显示源码"}];if(s){const d=()=>{const{icon:h,title:_}=n[+s.show],{icon:x}=n[+!s.show];t.classList.remove(x),t.classList.add(h),t.setAttribute("title",_)},m=()=>{var h;s.show=!1,d(),c.style.display="block",a.style.display="none",(h=s.chart)==null||h.dispose(),s.chart=null,a.innerHTML=""},p=()=>{s.show=!0,d(),c.style.display="none",a.style.display="block",showEchart(s,a,()=>{})};s.show?m():p()}},events={".code-block-header__copy":{click:[copyEvent]},".code-block-header__echart":{click:[echartControl]},".code-block-header__unfold":{click:[unfoldEvent]}};let removeEvents=[];const bindEvent=()=>{textRef.value&&(removeEvents.forEach(e=>e.remove()),Object.entries(events).forEach(([e,t])=>{Object.entries(t).forEach(([o,c])=>{const a=s=>{s.target.classList.value.includes(e.split(".")[1])&&c.forEach(n=>n(s))};textRef.value.addEventListener(o,a),removeEvents.push({selector:e,eventType:o,remove:()=>{textRef.value&&textRef.value.removeEventListener(o,a)}})})}))};let lightbox,lightboxTime;const initphotoswipe=()=>{!lightbox&&isImage&&(clearTimeout(lightboxTime),lightboxTime=setTimeout(()=>g(this,null,function*(){const e={gallery:"#TextComp"+props.data.id,childSelector:".gallery__item",pswpModule:()=>__vitePreload(()=>import("./chunk.4zk48.js"),[],import.meta.url),paddingFn:o=>({top:30,bottom:30,left:70,right:70})},t=document.querySelectorAll(".gallery__item");Array.from(t).map(o=>g(this,null,function*(){const c=o.getAttribute("url"),a=o.querySelector("a"),{width:s,height:n}=yield getImgWH$1(c);a.setAttribute("data-pswp-width",s),a.setAttribute("data-pswp-height",n)})),lightbox=new PhotoSwipeLightbox(e),lightbox.init()}),100))},resize=()=>{echartOptions.forEach(e=>{e.show&&e.chart&&e.chart.resize()})};return onMounted(()=>{initphotoswipe(),window.addEventListener("resize",resize),bindEvent()}),onUnmounted(()=>{clearTimeout(showTimer),clearTimeout(lightboxTime),lightbox&&(lightbox.destroy(),lightbox=null),window.removeEventListener("resize",resize),removeEvents.forEach(e=>e.remove())}),(e,t)=>(openBlock(),createElementBlock("div",{class:"TextComp answer",ref_key:"textRef",ref:textRef,id:"TextComp"+props.data.id},[createBaseVNode("div",{class:"markdown-body",innerHTML:text.value},null,8,_hoisted_2$2)],8,_hoisted_1$2))}},TextComp=_export_sfc(_sfc_main$2,[["__scopeId","data-v-27944a80"]]),MessageBody_vue_vue_type_style_index_0_scoped_65a60520_lang="",_hoisted_1$1={class:"messag-body"},_hoisted_2$1={class:"header flex_b"},_hoisted_3$1={class:"time"},_hoisted_4={class:"right"},_hoisted_5=["msg-id"],_sfc_main$1={__name:"MessageBody",props:{data:{type:Object,default:()=>{}}},emits:["control"],setup(e,{emit:t}){const o=ref([]),c=ref([]),a=useMessage();inject("resize");const s=e,{data:n}=s,r=t;let i=!1;const l=()=>{o.value=[],c.value=[],(n.attachments||[]).forEach(p=>g(this,null,function*(){const{mimeType:h,url:_}=p;if(IMG_TYPES.includes(h)){const{width:y,height:b}=yield getImgWH(_),k={width:y,height:b,src:_,thumbnailURL:_+"?image_process=resize,w_150"};if(i)return;o.value.push(k)}else c.value.push(p)}))},d=m=>g(this,null,function*(){const{content:p}=s.data;switch(m){case"delete":r("control",{type:"delete",data:s.data});break;case"copy":yield copyToClip(p),a.success("复制成功！");break}});return onMounted(()=>{l()}),onUnmounted(()=>{i=!0}),(m,p)=>(openBlock(),createElementBlock("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[createBaseVNode("div",_hoisted_3$1,toDisplayString(unref(format)(new Date(unref(n).createTime),"yyyy-MM-dd hh:mm:ss")),1),createBaseVNode("div",_hoisted_4,[createBaseVNode("span",{class:"hover_light iconfont icon-delete",onClick:p[0]||(p[0]=h=>d("delete")),title:"删除"}),createBaseVNode("span",{class:"hover_light iconfont icon-file-copy",onClick:p[1]||(p[1]=h=>d("copy")),title:"复制"})])]),createBaseVNode("div",{class:"text_wrapper","msg-id":unref(n).id},[createVNode(TextComp,{text:unref(n).content,data:unref(n)},null,8,["text","data"])],8,_hoisted_5)]))}},MessageBody=_export_sfc(_sfc_main$1,[["__scopeId","data-v-65a60520"]]),index_vue_vue_type_style_index_0_scoped_86cb7b23_lang="",_hoisted_1={class:"Favorites tpage"},_hoisted_2={key:0,class:"noData"},_hoisted_3={key:1,class:"noMoreData"},_sfc_main={__name:"index",setup(e){const t=useMessage(),{showToast:o,closeWatch:c,clearWatch:a}=useToast(),s=ref([]);let n,r=!1;const i=ref(!1),l=useRouter(),d=ref(!1),m=reactive({current:1,size:50}),{listDom:p,scolllDom:h,scroll:_,addScrollFun:x}=useScrollBottom(),y=()=>g(this,null,function*(){if(i.value)return;i.value=!0;const{current:f,pages:u,records:v,total:M}=yield favoritesList(m);s.value.push(...v.map(S=>T(B({},S),{open:!1}))),d.value=f>=u||s.value.length>=M,i.value=!1}),b=()=>routerBack(l,{name:"dialogue"}),k=()=>g(this,null,function*(){yield delFavorites({id:n.id}),t.success("删除成功");const f=s.value.findIndex(u=>u.id===n.id);s.value.splice(f,1),n=""}),$=v=>g(this,[v],function*({type:f,data:u}){if(!r){switch(r=!0,f){case"delete":n=u,o("del","你要取消收藏这条消息，确定吗？");break}r=!1}}),C=()=>{console.log("scrollBottom"),!(i.value||d.value)&&(m.current++,y())};return y(),onMounted(()=>{x(C),c("del",f=>{f&&k()})}),onUnmounted(()=>{a()}),(f,u)=>(openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("div",{class:"top_bar flex_b flex_sx_center"},[createBaseVNode("div",{class:"flex_sx_center back hover_bg",tabindex:"0",onClick:b},u[1]||(u[1]=[createBaseVNode("span",{class:"iconfont icon-rollback",style:{"font-size":"20px"}},null,-1),createBaseVNode("span",{class:"text",style:{"margin-left":"5px"}},"返回",-1)]))]),createBaseVNode("div",{class:"content",onScrollPassive:u[0]||(u[0]=(...v)=>unref(_)&&unref(_)(...v)),ref_key:"listDom",ref:p},[createBaseVNode("div",{ref_key:"scolllDom",ref:h},[(openBlock(!0),createElementBlock(Fragment,null,renderList(s.value,v=>(openBlock(),createElementBlock("div",{class:"item",key:v.id},[createVNode(MessageBody,{data:v,onControl:$},null,8,["data"])]))),128)),s.value.length?d.value?(openBlock(),createElementBlock("div",_hoisted_3,"没有更多了")):createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_2,"目前没有历史话题"))],512)],544)]))}},index=_export_sfc(_sfc_main,[["__scopeId","data-v-86cb7b23"]]);export{index as default};
