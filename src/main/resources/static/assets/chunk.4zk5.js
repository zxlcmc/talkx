var y=(t,n,s)=>new Promise((i,d)=>{var C=o=>{try{x(s.next(o))}catch(p){d(p)}},g=o=>{try{x(s.throw(o))}catch(p){d(p)}},x=o=>o.done?i(o.value):Promise.resolve(o.value).then(C,g);x((s=s.apply(t,n)).next())});import{g as I,aj as N,_ as Z,n as A,h as J,j as X,k as Y,c as u,q as $,ak as P,al as b,am as G,t as H,o as w,a as k,e as c,A as S,d as T,w as K,C as ee,Y as te,Z as se,v as f,f as D,D as ae,ah as oe,z as re,ae as ne}from"./bundle.0.0.2.js?v=0.6036900755232442";import{T as ce}from"./chunk.4zk40.js";import{p as O,q as ie}from"./chunk.4zk43.js";const j=I([{text:"商品名称",key:"productName",rightText:"-",noicon:!0},{text:"订单编号",key:"orderId",rightText:"-",noicon:!0},{text:"下单时间",key:"createTime",rightText:"-",noicon:!0},{text:"订单金额",key:"totalPrice",rightText:"-",noicon:!0}]),le=t=>{j.value.forEach(n=>{let s=t[n.key];s&&(n.key=="createTime"?s=N(new Date(s),"yyyy-MM-dd hh:mm:ss"):n.key=="totalPrice"&&(s="￥"+s.toFixed(2)),n.rightText=s)})},e={unpaid:0,progress:1,success:2,close:3,fail:4,cancel:98,noOrder:100},ue={[e.unpaid]:{color:"",icon:"icon-info-circle",text:"请支付"},[e.success]:{color:"#16aa68",icon:"icon-zhifuchenggong",text:"支付成功"},[e.fail]:{color:"#f4420a",icon:"icon-zhifushibai",text:"支付失败"},[e.progress]:{color:"",icon:"icon-info-circle",text:"正在支付"},[e.close]:{color:"",icon:"icon-info-circle",text:"订单已关闭"},[e.cancel]:{color:"#f4420a",icon:"icon-zhifushibai",text:"支付取消"},[e.noOrder]:{color:"",icon:"icon-info-circle",text:"订单不存在"}},de={"get_brand_wcpay_request:ok":e.success,"get_brand_wcpay_request:cancel":e.progress,"get_brand_wcpay_request:fail":e.fail},pe=t=>y(void 0,null,function*(){return new Promise((n,s)=>{try{console.log(";唤起支付",t,WeixinJSBridge),WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:t.appId,timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.package,signType:"MD5",paySign:t.paySign},i=>{console.log(";res",i);const d=de[i.err_msg];d?n(d):console.error("wx - invoke - result:",i)})}catch(i){console.log("wx - invoke - err:",err)}})}),E=()=>{const t=new URL(window.location.href);return t.host="plugin-web.talkx.cn",encodeURIComponent(t.toString())},_e=()=>{const t=E(),n="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx6ef283c4c49c2ea3&redirect_uri="+t+"&response_type=code&scope=snsapi_base&wechat_redirect="+t+"#wechat_redirect";window.location.href=n},M={invoke:pe,getUrl:E,redirectUrl:_e};const ve={class:"pay tpage"},ye={class:"topbar flex_b flex_sx_center"},fe={class:"text"},ge={class:"pay_content"},xe={class:"top_area"},me={key:0,class:"pay_status"},he={class:"pay_text"},we={key:1,class:"ewm_area"},ke={class:"text1"},be={class:"text2"},Se=["src"],Te={key:0,class:"btn_wrapper"},Ie={__name:"index",setup(t){const s=A().appContext.config.globalProperties.$bus,i=J(),d=X(),C=Y(),g=I(30*60),x=()=>{oe(d,{name:"userEdit",query:{type:"my_hashrate"}})};let o,p,m,q=!1;const l=I({}),r=I(""),h=u(()=>ue[r.value]),_=u(()=>P()||b()),B=u(()=>l.value.orderPageQrcode),U=u(()=>N(new Date(+new Date("2020/12/2 00:00:00")+g.value*1e3),"mm分ss秒")),F=u(()=>[e.fail].includes(r.value)?"取消":"返回"),R=u(()=>b()&&[e.unpaid,e.progress].includes(r.value)||!_.value&&[e.progress].includes(r.value)?h.value.text:"请使用微信扫码支付"),W=u(()=>{var a=![e.unpaid,e.progress].includes(r.value);return a&&h.value}),V=u(()=>{var a=[e.unpaid,e.progress].includes(r.value);return a}),L=()=>y(this,null,function*(){if(!q){if(q=!0,b()){const v=yield O({orderId:m,payType:2,clientType:2,wxCode:p});r.value=yield M.invoke(v)}else P()&&(yield O({orderId:m,payType:1,clientType:5,wxCode:p}));q=!1}}),z=()=>y(this,null,function*(){const a={err:!1};return l.value=yield ie({orderId:m}),l.value.err?(r.value=e.noOrder,C.error(l.value.msg),a.err=!0,a):(g.value=l.value.timeoutForPay,r.value=l.value.status,le(l.value),a)}),Q=()=>{clearInterval(o);const a=()=>[e.unpaid,e.progress].includes(r.value);a()&&(o=setInterval(()=>y(this,null,function*(){if(!a()){clearInterval(o);return}if(g.value<=0){clearInterval(o),r.value=e.close,cb();return}yield z()}),1e3))};return $(()=>y(this,null,function*(){m=i.query.order,!(!m||(M.getUrl(),(yield z()).err))&&(console.log("orderInfo",_.value,l),Q(),_.value&&(s.emit("controllist",!1),P()&&console.log("支付宝-支付初始化"),b()&&(p=G("code"))))})),H(()=>{clearInterval(o)}),(a,v)=>(w(),k("div",ve,[c("div",ye,[c("div",null,[_.value?T("",!0):(w(),k("div",{key:0,class:"flex_sx_center back hover_bg",tabindex:"0",onClick:x},[v[0]||(v[0]=c("span",{class:"iconfont icon-rollback",style:{"font-size":"20px"}},null,-1)),c("span",fe,S(F.value),1)]))])]),c("div",ge,[c("div",xe,[W.value?(w(),k("div",me,[c("span",{class:K(["iconfont",h.value.icon]),style:ee({color:h.value.color})},null,6),c("div",he,S(h.value.text),1)])):T("",!0),V.value?(w(),k("div",we,[c("div",ke,S(R.value),1),c("div",be,"请在 "+S(U.value)+" 内完成支付",1),te(c("img",{class:"ewm_img",src:B.value},null,8,Se),[[se,!_.value&&B.value&&[f(e).unpaid,f(e).progress].includes(r.value)]])])):T("",!0)]),D(ce,{list:f(j)},null,8,["list"]),_.value&&[f(e).unpaid,f(e).progress].includes(r.value)?(w(),k("div",Te,[D(f(ne),{block:"",type:"info",class:"btn",onClick:L},{default:ae(()=>v[1]||(v[1]=[re("立即支付")])),_:1})])):T("",!0)])]))}},ze=Z(Ie,[["__scopeId","data-v-265d9901"]]);export{ze as default};
