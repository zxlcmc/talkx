var L=(c,y,o)=>new Promise((f,_)=>{var b=a=>{try{u(o.next(a))}catch(p){_(p)}},i=a=>{try{u(o.throw(a))}catch(p){_(p)}},u=a=>a.done?f(a.value):Promise.resolve(a.value).then(b,i);u((o=o.apply(c,y)).next())});import{_ as D,bq as N,g as S,k as j,m as E,c as M,o as G,b as P,D as $,br as H,v as g,bs as J,bm as K,bt as O}from"./bundle.0.0.2.js?v=0.6036900755232442";import{b as Q}from"./chunk.4zk27.js";const k="^base64url^",A="data:image/png;base64,",V={__name:"index",props:{max:{type:Number,default:4},accept:{type:String,default:N},size:{type:Number,default:1/0},showFileList:{type:Boolean,default:!0},listType:{type:String,default:"image-card"},imgs:String,triggerClass:String,upLoadApi:String},emits:["update:imgs","success","error","remove","change"],setup(c,{expose:y,emit:o}){const f=S(null),_=j(),b=E(),i=c,{accept:u,size:a,listType:p,showFileList:C}=i,d=M(()=>i.imgs?i.imgs.replaceAll(A,k).split(",").map((s,t)=>(s=s.replaceAll(k,A),{url:s,status:"finished",id:t})):[]),r=o,z={"--n-dragger-color":"var(--tp_dl_bg_color)"},I={"talkx-token":b.token},l=S(d.value.map(({url:e},s)=>({url:e,id:s}))||[]);let v="",w;const U=x=>L(this,[x],function*({file:e,onFinish:s,onError:t}){try{const n=new FormData;n.append("file",e.file);let m=K;i.upLoadApi==="file"&&(m=O),v=yield m(n),l.value.push({url:v,id:e.id,name:e.name,size:e.file.size}),s()}catch(n){console.log("customRequest-err",n),w=n,t()}}),q=e=>{const{file:s}=e,t=l.value.findIndex(({id:h})=>h===s.id);l.value.splice(t,1);const x=d.value[t].url,m=d.value.filter((h,B)=>B!==t).map(({url:h})=>h).join(",");r("update:imgs",m),r("change",l.value),r("remove",{imgs:m,url:x})},F=e=>{const s=d.value.map(({url:x})=>x);s.push(v);const t=s.join(",");r("update:imgs",t),r("success",{imgs:t,url:v}),r("change",l.value)},R=({event:e,file:s})=>{const t=e||w.response.data;t&&r("error",t)},T=({file:e,fileList:s})=>e.file.size>a?(_.error("文件太大了"),!1):!0;return y({root:()=>f,clear:()=>l.value=[]}),(e,s)=>(G(),P(g(Q),{ref_key:"uploadRef",ref:f,class:"uploadComp",headers:I,style:z,max:c.max,action:g(J),"default-file-list":d.value,"list-type":g(p),"show-preview-button":!0,"on-before-upload":T,"on-remove":q,"on-finish":F,"show-file-list":g(C),"on-error":R,accept:g(u),"trigger-class":c.triggerClass,"custom-request":U},{default:$(()=>[H(e.$slots,"default",{},void 0,!0)]),_:3},8,["max","action","default-file-list","list-type","show-file-list","accept","trigger-class"]))}},Z=D(V,[["__scopeId","data-v-d45d7ed4"]]);export{Z as U};
