var U=(a,c,m)=>new Promise((w,p)=>{var v=f=>{try{h(m.next(f))}catch(r){p(r)}},_=f=>{try{h(m.throw(f))}catch(r){p(r)}},h=f=>f.done?w(f.value):Promise.resolve(f.value).then(v,_);h((m=m.apply(a,c)).next())});import{bu as We,ao as Be,az as Re,b1 as se,bv as Oe,c as X,b5 as j,bw as Ae,bx as O,by as qe,aB as F,bz as Ee,aD as Ke,bA as Ge,aw as Me,ay as M,bB as Ue,ax as ve,a$ as E,bC as $e,b0 as He,g as k,b3 as je,b4 as Je,bD as me,b6 as Xe,bE as he,bF as Y,bG as Ye,bH as Qe,bb as ge,_ as oe,h as _e,k as ie,p as we,q as xe,o as C,a as I,e as s,f as n,D as i,z as $,v as o,ae as W,F as Q,x as ke,A as J,bI as Se,a1 as N,u as Ze,j as et,b as A,d as L,bt as tt,bJ as lt,bK as at,bL as ot}from"./bundle.0.0.2.js?v=0.6036900755232442";import{N as Ce}from"./chunk.4zk42.js";import{b as le,N as T,a as be,c as rt,d as re}from"./chunk.4zk49.js";import{N as ae}from"./chunk.4zk31.js";import{b as nt,c as st}from"./chunk.4zk27.js";import"./chunk.4zk50.js";import"./chunk.4zk23.js";import"./chunk.4zk34.js";import"./chunk.4zk39.js";function it(a,c="default",m=[]){const p=a.$slots[c];return p===void 0?m:p()}const ut={gapSmall:"4px 8px",gapMedium:"8px 12px",gapLarge:"12px 16px"};function dt(){return ut}const ct={name:"Space",self:dt},pt=ct;let ye;function ft(){if(!We)return!0;if(ye===void 0){const a=document.createElement("div");a.style.display="flex",a.style.flexDirection="column",a.style.rowGap="1px",a.appendChild(document.createElement("div")),a.appendChild(document.createElement("div")),document.body.appendChild(a);const c=a.scrollHeight===1;return document.body.removeChild(a),ye=c}return ye}const vt=Object.assign(Object.assign({},se.props),{align:String,justify:{type:String,default:"start"},inline:Boolean,vertical:Boolean,reverse:Boolean,size:{type:[String,Number,Array],default:"medium"},wrapItem:{type:Boolean,default:!0},itemClass:String,itemStyle:[String,Object],wrap:{type:Boolean,default:!0},internalUseGap:{type:Boolean,default:void 0}}),Z=Be({name:"Space",props:vt,setup(a){const{mergedClsPrefixRef:c,mergedRtlRef:m}=Re(a),w=se("Space","-space",void 0,pt,a,c),p=Oe("Space",m,c);return{useGap:ft(),rtlEnabled:p,mergedClsPrefix:c,margin:X(()=>{const{size:v}=a;if(Array.isArray(v))return{horizontal:v[0],vertical:v[1]};if(typeof v=="number")return{horizontal:v,vertical:v};const{self:{[j("gap",v)]:_}}=w.value,{row:h,col:f}=Ae(_);return{horizontal:O(f),vertical:O(h)}})}},render(){const{vertical:a,reverse:c,align:m,inline:w,justify:p,itemClass:v,itemStyle:_,margin:h,wrap:f,mergedClsPrefix:r,rtlEnabled:b,useGap:x,wrapItem:y,internalUseGap:z}=this,B=qe(it(this),!1);if(!B.length)return null;const P=`${h.horizontal}px`,V=`${h.horizontal/2}px`,D=`${h.vertical}px`,g=`${h.vertical/2}px`,u=B.length-1,S=p.startsWith("space-");return F("div",{role:"none",class:[`${r}-space`,b&&`${r}-space--rtl`],style:{display:w?"inline-flex":"flex",flexDirection:(()=>a&&!c?"column":a&&c?"column-reverse":!a&&c?"row-reverse":"row")(),justifyContent:["start","end"].includes(p)?`flex-${p}`:p,flexWrap:!f||a?"nowrap":"wrap",marginTop:x||a?"":`-${g}`,marginBottom:x||a?"":`-${g}`,alignItems:m,gap:x?`${h.vertical}px ${h.horizontal}px`:""}},!y&&(x||z)?B:B.map((l,e)=>l.type===Ee?l:F("div",{role:"none",class:v,style:[_,{maxWidth:"100%"},x?"":a?{marginBottom:e!==u?D:""}:b?{marginLeft:S?p==="space-between"&&e===u?"":V:e!==u?P:"",marginRight:S?p==="space-between"&&e===0?"":V:"",paddingTop:g,paddingBottom:g}:{marginRight:S?p==="space-between"&&e===u?"":V:e!==u?P:"",marginLeft:S?p==="space-between"&&e===0?"":V:"",paddingTop:g,paddingBottom:g}]},l)))}}),mt={buttonHeightSmall:"14px",buttonHeightMedium:"18px",buttonHeightLarge:"22px",buttonWidthSmall:"14px",buttonWidthMedium:"18px",buttonWidthLarge:"22px",buttonWidthPressedSmall:"20px",buttonWidthPressedMedium:"24px",buttonWidthPressedLarge:"28px",railHeightSmall:"18px",railHeightMedium:"22px",railHeightLarge:"26px",railWidthSmall:"32px",railWidthMedium:"40px",railWidthLarge:"48px"};function ht(a){const{primaryColor:c,opacityDisabled:m,borderRadius:w,textColor3:p}=a,v="rgba(0, 0, 0, .14)";return Object.assign(Object.assign({},mt),{iconColor:p,textColor:"white",loadingColor:c,opacityDisabled:m,railColor:v,railColorActive:c,buttonBoxShadow:"0 1px 4px 0 rgba(0, 0, 0, 0.3), inset 0 0 1px 0 rgba(0, 0, 0, 0.05)",buttonColor:"#FFF",railBorderRadiusSmall:w,railBorderRadiusMedium:w,railBorderRadiusLarge:w,buttonBorderRadiusSmall:w,buttonBorderRadiusMedium:w,buttonBorderRadiusLarge:w,boxShadowFocus:`0 0 0 2px ${Ge(c,{alpha:.2})}`})}const gt={name:"Switch",common:Ke,self:ht},bt=gt,yt=Me("switch",`
 height: var(--n-height);
 min-width: var(--n-width);
 vertical-align: middle;
 user-select: none;
 -webkit-user-select: none;
 display: inline-flex;
 outline: none;
 justify-content: center;
 align-items: center;
`,[M("children-placeholder",`
 height: var(--n-rail-height);
 display: flex;
 flex-direction: column;
 overflow: hidden;
 pointer-events: none;
 visibility: hidden;
 `),M("rail-placeholder",`
 display: flex;
 flex-wrap: none;
 `),M("button-placeholder",`
 width: calc(1.75 * var(--n-rail-height));
 height: var(--n-rail-height);
 `),Me("base-loading",`
 position: absolute;
 top: 50%;
 left: 50%;
 transform: translateX(-50%) translateY(-50%);
 font-size: calc(var(--n-button-width) - 4px);
 color: var(--n-loading-color);
 transition: color .3s var(--n-bezier);
 `,[Ue({left:"50%",top:"50%",originalTransform:"translateX(-50%) translateY(-50%)"})]),M("checked, unchecked",`
 transition: color .3s var(--n-bezier);
 color: var(--n-text-color);
 box-sizing: border-box;
 position: absolute;
 white-space: nowrap;
 top: 0;
 bottom: 0;
 display: flex;
 align-items: center;
 line-height: 1;
 `),M("checked",`
 right: 0;
 padding-right: calc(1.25 * var(--n-rail-height) - var(--n-offset));
 `),M("unchecked",`
 left: 0;
 justify-content: flex-end;
 padding-left: calc(1.25 * var(--n-rail-height) - var(--n-offset));
 `),ve("&:focus",[M("rail",`
 box-shadow: var(--n-box-shadow-focus);
 `)]),E("round",[M("rail","border-radius: calc(var(--n-rail-height) / 2);",[M("button","border-radius: calc(var(--n-button-height) / 2);")])]),$e("disabled",[$e("icon",[E("rubber-band",[E("pressed",[M("rail",[M("button","max-width: var(--n-button-width-pressed);")])]),M("rail",[ve("&:active",[M("button","max-width: var(--n-button-width-pressed);")])]),E("active",[E("pressed",[M("rail",[M("button","left: calc(100% - var(--n-offset) - var(--n-button-width-pressed));")])]),M("rail",[ve("&:active",[M("button","left: calc(100% - var(--n-offset) - var(--n-button-width-pressed));")])])])])])]),E("active",[M("rail",[M("button","left: calc(100% - var(--n-button-width) - var(--n-offset))")])]),M("rail",`
 overflow: hidden;
 height: var(--n-rail-height);
 min-width: var(--n-rail-width);
 border-radius: var(--n-rail-border-radius);
 cursor: pointer;
 position: relative;
 transition:
 opacity .3s var(--n-bezier),
 background .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier);
 background-color: var(--n-rail-color);
 `,[M("button-icon",`
 color: var(--n-icon-color);
 transition: color .3s var(--n-bezier);
 font-size: calc(var(--n-button-height) - 4px);
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 display: flex;
 justify-content: center;
 align-items: center;
 line-height: 1;
 `,[Ue()]),M("button",`
 align-items: center; 
 top: var(--n-offset);
 left: var(--n-offset);
 height: var(--n-button-height);
 width: var(--n-button-width-pressed);
 max-width: var(--n-button-width);
 border-radius: var(--n-button-border-radius);
 background-color: var(--n-button-color);
 box-shadow: var(--n-button-box-shadow);
 box-sizing: border-box;
 cursor: inherit;
 content: "";
 position: absolute;
 transition:
 background-color .3s var(--n-bezier),
 left .3s var(--n-bezier),
 opacity .3s var(--n-bezier),
 max-width .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier);
 `)]),E("active",[M("rail","background-color: var(--n-rail-color-active);")]),E("loading",[M("rail",`
 cursor: wait;
 `)]),E("disabled",[M("rail",`
 cursor: not-allowed;
 opacity: .5;
 `)])]),_t=Object.assign(Object.assign({},se.props),{size:{type:String,default:"medium"},value:{type:[String,Number,Boolean],default:void 0},loading:Boolean,defaultValue:{type:[String,Number,Boolean],default:!1},disabled:{type:Boolean,default:void 0},round:{type:Boolean,default:!0},"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],checkedValue:{type:[String,Number,Boolean],default:!0},uncheckedValue:{type:[String,Number,Boolean],default:!1},railStyle:Function,rubberBand:{type:Boolean,default:!0},onChange:[Function,Array]});let te;const ne=Be({name:"Switch",props:_t,slots:Object,setup(a){te===void 0&&(typeof CSS!="undefined"?typeof CSS.supports!="undefined"?te=CSS.supports("width","max(1px)"):te=!1:te=!0);const{mergedClsPrefixRef:c,inlineThemeDisabled:m}=Re(a),w=se("Switch","-switch",yt,bt,a,c),p=He(a),{mergedSizeRef:v,mergedDisabledRef:_}=p,h=k(a.defaultValue),f=je(a,"value"),r=Je(f,h),b=X(()=>r.value===a.checkedValue),x=k(!1),y=k(!1),z=X(()=>{const{railStyle:d}=a;if(d)return d({focused:y.value,checked:b.value})});function B(d){const{"onUpdate:value":q,onChange:K,onUpdateValue:R}=a,{nTriggerFormInput:ue,nTriggerFormChange:de}=p;q&&ge(q,d),R&&ge(R,d),K&&ge(K,d),h.value=d,ue(),de()}function P(){const{nTriggerFormFocus:d}=p;d()}function V(){const{nTriggerFormBlur:d}=p;d()}function D(){a.loading||_.value||(r.value!==a.checkedValue?B(a.checkedValue):B(a.uncheckedValue))}function g(){y.value=!0,P()}function u(){y.value=!1,V(),x.value=!1}function S(d){a.loading||_.value||d.key===" "&&(r.value!==a.checkedValue?B(a.checkedValue):B(a.uncheckedValue),x.value=!1)}function l(d){a.loading||_.value||d.key===" "&&(d.preventDefault(),x.value=!0)}const e=X(()=>{const{value:d}=v,{self:{opacityDisabled:q,railColor:K,railColorActive:R,buttonBoxShadow:ue,buttonColor:de,boxShadowFocus:Te,loadingColor:ze,textColor:Ve,iconColor:Fe,[j("buttonHeight",d)]:G,[j("buttonWidth",d)]:Ne,[j("buttonWidthPressed",d)]:Ie,[j("railHeight",d)]:H,[j("railWidth",d)]:ee,[j("railBorderRadius",d)]:De,[j("buttonBorderRadius",d)]:Pe},common:{cubicBezierEaseInOut:Le}}=w.value;let ce,pe,fe;return te?(ce=`calc((${H} - ${G}) / 2)`,pe=`max(${H}, ${G})`,fe=`max(${ee}, calc(${ee} + ${G} - ${H}))`):(ce=me((O(H)-O(G))/2),pe=me(Math.max(O(H),O(G))),fe=O(H)>O(G)?ee:me(O(ee)+O(G)-O(H))),{"--n-bezier":Le,"--n-button-border-radius":Pe,"--n-button-box-shadow":ue,"--n-button-color":de,"--n-button-width":Ne,"--n-button-width-pressed":Ie,"--n-button-height":G,"--n-height":pe,"--n-offset":ce,"--n-opacity-disabled":q,"--n-rail-border-radius":De,"--n-rail-color":K,"--n-rail-color-active":R,"--n-rail-height":H,"--n-rail-width":ee,"--n-width":fe,"--n-box-shadow-focus":Te,"--n-loading-color":ze,"--n-text-color":Ve,"--n-icon-color":Fe}}),t=m?Xe("switch",X(()=>v.value[0]),e,a):void 0;return{handleClick:D,handleBlur:u,handleFocus:g,handleKeyup:S,handleKeydown:l,mergedRailStyle:z,pressed:x,mergedClsPrefix:c,mergedValue:r,checked:b,mergedDisabled:_,cssVars:m?void 0:e,themeClass:t==null?void 0:t.themeClass,onRender:t==null?void 0:t.onRender}},render(){const{mergedClsPrefix:a,mergedDisabled:c,checked:m,mergedRailStyle:w,onRender:p,$slots:v}=this;p==null||p();const{checked:_,unchecked:h,icon:f,"checked-icon":r,"unchecked-icon":b}=v,x=!(he(f)&&he(r)&&he(b));return F("div",{role:"switch","aria-checked":m,class:[`${a}-switch`,this.themeClass,x&&`${a}-switch--icon`,m&&`${a}-switch--active`,c&&`${a}-switch--disabled`,this.round&&`${a}-switch--round`,this.loading&&`${a}-switch--loading`,this.pressed&&`${a}-switch--pressed`,this.rubberBand&&`${a}-switch--rubber-band`],tabindex:this.mergedDisabled?void 0:0,style:this.cssVars,onClick:this.handleClick,onFocus:this.handleFocus,onBlur:this.handleBlur,onKeyup:this.handleKeyup,onKeydown:this.handleKeydown},F("div",{class:`${a}-switch__rail`,"aria-hidden":"true",style:w},Y(_,y=>Y(h,z=>y||z?F("div",{"aria-hidden":!0,class:`${a}-switch__children-placeholder`},F("div",{class:`${a}-switch__rail-placeholder`},F("div",{class:`${a}-switch__button-placeholder`}),y),F("div",{class:`${a}-switch__rail-placeholder`},F("div",{class:`${a}-switch__button-placeholder`}),z)):null)),F("div",{class:`${a}-switch__button`},Y(f,y=>Y(r,z=>Y(b,B=>F(Ye,null,{default:()=>this.loading?F(Qe,{key:"loading",clsPrefix:a,strokeWidth:20}):this.checked&&(z||y)?F("div",{class:`${a}-switch__button-icon`,key:z?"checked-icon":"icon"},z||y):!this.checked&&(B||y)?F("div",{class:`${a}-switch__button-icon`,key:B?"unchecked-icon":"icon"},B||y):null})))),Y(_,y=>y&&F("div",{key:"checked",class:`${a}-switch__checked`},y)),Y(h,y=>y&&F("div",{key:"unchecked",class:`${a}-switch__unchecked`},y)))))}});const wt={class:"device_list"},xt={class:"bind-btn-wrapper"},kt={key:0},St=["onClick"],Ct={__name:"DeviceList",setup(a){const c=_e(),m=ie(),w=k([]),{showToast:p,closeWatch:v,clearWatch:_}=we();let h=null;const f=k(!1);k("");const r=k(!1),b=k(null),x=k({code:""}),y={code:{required:!0,message:"",trigger:["blur","change"],validator:(l,e)=>/^\d{6}$/.test(e)?!0:new Error("请输入6位数字验证码")}},z=()=>{f.value=!0,x.value.code=""},B=()=>U(this,null,function*(){var l,e;try{yield(l=b.value)==null?void 0:l.validate(),r.value=!0;const{userFriendId:t}=c.query;yield N({url:"/device/bind",method:"POST",data:{code:x.value.code,userFriendId:t}}),m.success("绑定成功"),f.value=!1,D()}catch(t){(e=t==null?void 0:t.response)!=null&&e.data&&m.error(t.response.data)}finally{r.value=!1}}),P=()=>{f.value=!1,x.value.code=""},V={"--n-border-radius":"0px","--n-td-text-color":"var(--tp_textcolor)","--n-th-text-color":"var(--tp_textcolor)","--n-td-color":"var(--tp_footer_bgcolor)","--n-th-color":"var(--tp_footer_bgcolor)","--n-merged-border-color":"var(--tp_aside_border_color)"},D=()=>U(this,null,function*(){const{userFriendId:l}=c.query;l&&N({url:"/device/list",method:"GET",params:{userFriendId:l}}).then(e=>{w.value=e}).catch(e=>{})}),g=l=>{h=l,window.__talkx_event_stop=!0,p("del","确定要解绑该设备吗？")},u=l=>U(this,null,function*(){if(!l){h=null;return}h&&N({url:"/device/unbind",method:"POST",data:{deviceId:h.id}}).then(e=>{D()}).catch(e=>{m.error(e.response.data||"解绑失败")}).finally(()=>{h=null})}),S=(l,e)=>U(this,null,function*(){const t=l.otaUpdate;l.otaUpdate=e?1:0,N({url:"/device/update",method:"POST",data:{deviceId:l.id,autoOtaUpgrade:e?1:0}}).then(d=>{D()}).catch(d=>{l.otaUpdate=t,m.error(d.response.data||"设置失败")})});return xe(()=>{D()}),v("del",u),(l,e)=>(C(),I(Q,null,[s("div",wt,[s("div",xt,[n(o(W),{type:"info",onClick:z},{default:i(()=>e[2]||(e[2]=[$("绑定新设备")])),_:1})]),n(o(Ce),{bordered:!1,"single-line":!1,style:V},{default:i(()=>[e[4]||(e[4]=s("thead",null,[s("tr",null,[s("th",null,"设备型号"),s("th",null,"芯片型号"),s("th",null,"固件版本"),s("th",null,"MAC地址"),s("th",null,"绑定时间"),s("th",null,"自动更新"),s("th",null,"操作")])],-1)),s("tbody",null,[w.value.length===0?(C(),I("tr",kt,e[3]||(e[3]=[s("td",{colspan:"7",style:{"text-align":"center",padding:"20px"}},"没有任何设备，请先绑定",-1)]))):(C(!0),I(Q,{key:1},ke(w.value,t=>(C(),I("tr",{key:t.id},[s("td",null,J(t.deviceModel),1),s("td",null,J(t.chipModelName),1),s("td",null,J(t.firmwareVersion),1),s("td",null,J(t.macAddress),1),s("td",null,J(t.bindTime),1),s("td",null,[n(o(ne),{value:t.otaUpdate===1,"onUpdate:value":d=>S(t,d)},null,8,["value","onUpdate:value"])]),s("td",null,[s("span",{class:"unbind-btn",onClick:d=>g(t)},"解绑",8,St)])]))),128))])]),_:1})]),n(o(Se),{show:f.value,"onUpdate:show":e[1]||(e[1]=t=>f.value=t),preset:"dialog",title:"绑定设备",closable:!1,"show-icon":!1,"transform-origin":"center"},{action:i(()=>[n(o(Z),null,{default:i(()=>[n(o(W),{quaternary:"",onClick:P},{default:i(()=>e[6]||(e[6]=[$("取消")])),_:1}),n(o(W),{type:"info",loading:r.value,onClick:B},{default:i(()=>e[7]||(e[7]=[$("确认")])),_:1},8,["loading"])]),_:1})]),default:i(()=>[n(o(le),{ref_key:"formRef",ref:b,model:x.value,rules:y,"label-placement":"left","label-width":80,"require-mark-placement":"right-hanging"},{default:i(()=>[n(o(T),{label:"验证码",path:"code"},{default:i(()=>[n(o(ae),{value:x.value.code,"onUpdate:value":e[0]||(e[0]=t=>x.value.code=t),placeholder:"6位数字验证码",maxlength:"6"},null,8,["value"])]),_:1}),n(o(T),{label:" ",style:{color:"#b7b7b7","font-size":"12px","margin-top":"-20px"}},{default:i(()=>e[5]||(e[5]=[$(" 输入设备播报的6位数字验证码 ")])),_:1})]),_:1},8,["model"])]),_:1},8,["show"])],64))}},Mt=oe(Ct,[["__scopeId","data-v-ea608992"]]);const Ut=["src"],$t={class:"footer flex"},Bt={__name:"AudioConfig",setup(a){Ze(l=>({"30c562b8":l.itemW}));const c=_e();et();const m=ie(),w=k(null),p=k([]),v=k([]),_=k(""),h=k(!1),f=k(!1),r=k({role:"",customModel:0,proxyBaseUrl:"",apiKey:"",llmModel:k(null),isSupportTool:0}),b={role:{required:!0,message:"请选择声音角色",trigger:["blur","change"]},proxyBaseUrl:{required:X(()=>r.value.customModel===1),message:"",trigger:["blur","change"]},apiKey:{required:X(()=>r.value.customModel===1),message:"",trigger:["blur","change"]}},x=k(!1),y=()=>U(this,null,function*(){var l;try{const e=yield N({url:"/friend/media/get",method:"GET",params:{userFriendId:c.query.userFriendId}});if(e){const{userFriendMediaConfig:t,user:d}=e;return r.value={role:t.audioRole,customModel:t.customModel,llmModel:t.llmModel,proxyBaseUrl:t.proxyBaseUrl,apiKey:t.apiKey,isSupportTool:t.isSupportTool},e}return null}catch(e){return m.error(((l=e.response)==null?void 0:l.data)||"获取当前配置失败"),null}}),z=()=>U(this,null,function*(){try{const l=yield N({url:"/user/voice/list",method:"GET"});if(l&&l.length>0){const e=l.map(t=>({label:t.voiceName,value:t.audioRole,demoUrl:t.voiceSrcUrl,platformType:t.audioPlatformType||"Alibaba",model:t.audioModel||"cosyvoice-v1",isUserVoice:!0}));return e.length>0?[{type:"group",label:"我的声音",key:"user-voices",children:e}]:[]}return[]}catch(l){return console.error("获取用户复刻声音失败:",l),[]}}),B=()=>U(this,null,function*(){const l=yield N({url:"/user/info/list_model",method:"GET"});v.value=l.map(e=>({label:e.model,value:e.model,icon:e.icon,costCoin:e.costCoin,canSelection:e.canSelection,supportTool:e.supportTool}))}),P=()=>U(this,null,function*(){var l,e;try{x.value=!0;const t=yield z(),d=yield N({url:"/friend/media/audio_configs",method:"GET"});if(d&&d.length>0){const K={type:"group",label:"系统声音",key:"system-voices",children:d.map(R=>({label:R.name+" ("+R.languages+")",value:R.role,demoUrl:R.demoUrl,platformType:R.platformType||"Alibaba",model:R.model||"cosyvoice-v1",isUserVoice:!1}))};if(p.value=[...t,K],r.value.role){const R=V(r.value.role,p.value);R&&(_.value=R.demoUrl)}else{const R=p.value[0];R.type==="group"&&((l=R.children)==null?void 0:l.length)>0&&(r.value.role=R.children[0].value,_.value=R.children[0].demoUrl)}}}catch(t){m.error(((e=t.response)==null?void 0:e.data)||"获取配置失败")}finally{x.value=!1}}),V=(l,e)=>{for(const t of e)if(t.type==="group"&&t.children){const d=t.children.find(q=>q.value===l&&!q.disabled);if(d)return d}else if(t.value===l&&!t.disabled)return t;return null},D=l=>{const e=V(l,p.value);e&&(_.value=e.demoUrl)},g=l=>{const e=v.value.find(t=>t.value===l);e&&(r.value.isSupportTool=e.supportTool?1:0)},u=()=>U(this,null,function*(){var l;yield(l=w.value)==null?void 0:l.validate(),h.value=!0,N({url:"/friend/media/test",method:"POST",data:{llmModel:r.value.llmModel,proxyBaseUrl:r.value.proxyBaseUrl,apiKey:r.value.apiKey}}).then(e=>{m.success("测试通过！")}).catch(e=>{var t;m.error(((t=e.response)==null?void 0:t.data)||"测试失败")}).finally(()=>{h.value=!1})}),S=()=>U(this,null,function*(){var l,e;try{yield(l=w.value)==null?void 0:l.validate(),f.value=!0;const t=V(r.value.role,p.value);if(!t)throw new Error("未找到选中的声音角色");const d=t.demoUrl||"",q=t.platformType||"Alibaba",K=t.model||"cosyvoice-v1",R=yield N({url:"/friend/media/update",method:"POST",data:{userFriendId:c.query.userFriendId,audioPlatformType:q,audioModel:K,audioRole:r.value.role,audioDemoUrl:d,customModel:r.value.customModel,llmModel:r.value.llmModel,proxyBaseUrl:r.value.proxyBaseUrl,apiKey:r.value.apiKey,isSupportTool:r.value.isSupportTool}});m.success("保存成功")}catch(t){(e=t.response)!=null&&e.data?m.error(t.response.data):m.error("保存失败")}finally{f.value=!1}});return xe(()=>U(this,null,function*(){var l;x.value=!0;try{yield B(),yield P();const e=yield y();let t=null;if(e&&(t=V(e.userFriendMediaConfig.audioRole,p.value)),!t&&p.value.length>0){const d=p.value[0];d.type==="group"&&((l=d.children)==null?void 0:l.length)>0&&(t=d.children[0])}t&&(r.value.role=t.value,_.value=t.demoUrl)}catch(e){m.error("初始化失败")}finally{x.value=!1}})),(l,e)=>(C(),A(o(le),{class:"formComp",ref_key:"formRef",ref:w,model:r.value,rules:b,"label-placement":"left","label-width":112,"require-mark-placement":"right-hanging",size:"medium"},{default:i(()=>[e[11]||(e[11]=s("div",{class:"diver"},"声音设置",-1)),n(o(T),{label:"声音角色",path:"role"},{default:i(()=>[n(o(be),{class:"tp_select",value:r.value.role,"onUpdate:value":[e[0]||(e[0]=t=>r.value.role=t),D],options:p.value,loading:x.value},null,8,["value","options","loading"])]),_:1}),_.value?(C(),A(o(T),{key:0,label:"试听"},{default:i(()=>[s("audio",{src:_.value,controls:""},null,8,Ut)]),_:1})):L("",!0),e[12]||(e[12]=s("div",{class:"diver"},"模型设置",-1)),n(o(T),{label:"自定义模型"},{default:i(()=>[n(o(Z),null,{default:i(()=>[n(o(ne),{value:r.value.customModel,"onUpdate:value":e[1]||(e[1]=t=>r.value.customModel=t),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1})]),_:1}),r.value.customModel===1?(C(),A(o(T),{key:1,label:" ",style:{color:"#b7b7b7","font-size":"12px","margin-top":"-20px"}},{default:i(()=>e[7]||(e[7]=[$(" 自定义模型服务，必须支持OpenAI协议。 ")])),_:1})):L("",!0),r.value.customModel===1?(C(),A(o(T),{key:2,label:"模型地址",path:"proxyBaseUrl"},{default:i(()=>[n(o(ae),{class:"_input",value:r.value.proxyBaseUrl,"onUpdate:value":e[2]||(e[2]=t=>r.value.proxyBaseUrl=t),placeholder:"请输入模型地址，如：https://api.aigateway.work/v1/"},null,8,["value"])]),_:1})):L("",!0),r.value.customModel===1?(C(),A(o(T),{key:3,label:"模型密钥",path:"apiKey"},{default:i(()=>[n(o(ae),{class:"_input",value:r.value.apiKey,"onUpdate:value":e[3]||(e[3]=t=>r.value.apiKey=t),placeholder:"请输入模型密钥，如：sk-8P7p27Stw5lkMn0jhHx6u6g8hfa7zXO1Jw8CPofz"},null,8,["value"])]),_:1})):L("",!0),n(o(T),{label:"设置模型"},{default:i(()=>[r.value.customModel===1?(C(),A(o(be),{key:0,class:"tp_select",value:r.value.llmModel,"onUpdate:value":[e[4]||(e[4]=t=>r.value.llmModel=t),g],options:v.value,filterable:"",tag:""},null,8,["value","options"])):L("",!0),r.value.customModel===0?(C(),A(o(be),{key:1,class:"tp_select",value:r.value.llmModel,"onUpdate:value":[e[5]||(e[5]=t=>r.value.llmModel=t),g],options:v.value},null,8,["value","options"])):L("",!0)]),_:1}),n(o(T),{label:" ",style:{color:"#b7b7b7","font-size":"12px","margin-top":"-20px"}},{default:i(()=>e[8]||(e[8]=[$(" 设置这个AI的模型，仅使用“智体”绑定的设备聊天时有效。使用自定义模型时允许自由输入。 ")])),_:1}),n(o(T),{label:"是否支持IoT"},{default:i(()=>[n(o(Z),null,{default:i(()=>[n(o(ne),{value:r.value.isSupportTool,"onUpdate:value":e[6]||(e[6]=t=>r.value.isSupportTool=t),"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1})]),_:1}),n(o(T),null,{default:i(()=>[s("div",$t,[r.value.customModel===1?(C(),A(o(W),{key:0,class:"testbtn",type:"default",onClick:u,loading:h.value},{default:i(()=>e[9]||(e[9]=[$(" 测试自定义模型服务 ")])),_:1},8,["loading"])):L("",!0),n(o(W),{class:"_confirm_btn",type:"info",onClick:S,loading:f.value},{default:i(()=>e[10]||(e[10]=[$("保存")])),_:1},8,["loading"])])]),_:1})]),_:1},8,["model"]))}},Rt=oe(Bt,[["__scopeId","data-v-0f722612"]]);const Tt={class:"voice_clone"},zt={key:0,class:"audio-preview",style:{"margin-top":"10px"}},Vt=["src"],Ft={key:0,class:"progress_section"},Nt={class:"clone_list"},It={class:"bind-btn-wrapper"},Dt={key:0},Pt=["src"],Lt={__name:"VoiceClone",setup(a){const c=ie(),{showToast:m,closeWatch:w,clearWatch:p}=we();let v=null;const _=k(!1),h=k(!1),f=k([]),r=k(null),b=k({voiceName:"",voiceSrcUrl:""}),x={voiceName:{required:!0,message:"",trigger:["blur","change"]},voiceSrcUrl:{required:!0,message:"请上传音频文件",trigger:["blur","change"]}},y=()=>U(this,null,function*(){try{const g=yield N({url:"/user/voice/list",method:"GET"});g&&g.length>0?f.value=g.map(u=>({id:u.id,name:u.voiceName,createTime:new Date(u.createTime).toLocaleString(),voiceSrcUrl:u.voiceSrcUrl})):f.value=[]}catch(g){c.error("获取声音列表失败")}}),z=u=>U(this,[u],function*({file:g}){if(g.file.size>10*1024*1024){c.error("文件大小不能超过10MB");return}const S=new FormData;S.append("file",g.file),tt(S).then(l=>{console.log(l),b.value.voiceSrcUrl=l,c.success("文件上传成功")}).catch(l=>{console.log(l),c.error("文件上传失败")})}),B=()=>U(this,null,function*(){try{h.value=!0,(yield N({url:"/user/voice/add",method:"POST",data:{voiceName:b.value.voiceName,voiceSrcUrl:b.value.voiceSrcUrl}}))&&(c.success("声音复刻成功"),_.value=!1,b.value={voiceName:"",voiceSrcUrl:""},y())}catch(g){c.error(g.response.data||"声音复刻失败")}finally{h.value=!1}}),P=g=>{v=g,m("del","确定删除该复刻的声音吗？")},V=g=>U(this,null,function*(){if(!g){v=null;return}v&&N({url:"/user/voice/delete",method:"POST",data:{id:v.id}}).then(u=>{c.success("删除成功"),y()}).catch(u=>{c.error(u.response.data||"删除失败")})});xe(()=>{y()}),w("del",V);const D={"--n-border-radius":"0px","--n-td-text-color":"var(--tp_textcolor)","--n-th-text-color":"var(--tp_textcolor)","--n-td-color":"var(--tp_footer_bgcolor)","--n-th-color":"var(--tp_footer_bgcolor)","--n-merged-border-color":"var(--tp_aside_border_color)"};return(g,u)=>(C(),I(Q,null,[s("div",Tt,[n(o(Se),{show:_.value,"onUpdate:show":u[2]||(u[2]=S=>_.value=S),preset:"dialog",style:{width:"600px"},"transform-origin":"center",title:"复刻声音",closable:!1,"show-icon":!1},{action:i(()=>[n(o(Z),null,{default:i(()=>[n(o(W),{quaternary:"",onClick:u[1]||(u[1]=S=>_.value=!1)},{default:i(()=>u[6]||(u[6]=[$("取消")])),_:1}),n(o(W),{type:"info",disabled:!b.value.voiceName||!b.value.voiceSrcUrl,loading:h.value,onClick:B},{default:i(()=>u[7]||(u[7]=[$(" 复刻 ")])),_:1},8,["disabled","loading"])]),_:1})]),default:i(()=>[n(o(le),{ref_key:"formRef",ref:r,model:b.value,rules:x,"label-placement":"left","label-width":80,"require-mark-placement":"right-hanging"},{default:i(()=>[n(o(T),{label:"声音名称",path:"voiceName"},{default:i(()=>[n(o(ae),{value:b.value.voiceName,"onUpdate:value":u[0]||(u[0]=S=>b.value.voiceName=S),placeholder:"请输入声音名称"},null,8,["value"])]),_:1}),n(o(T),{label:"音频文件",path:"voiceSrcUrl"},{default:i(()=>[n(o(nt),{accept:".mp3,.wav,.m4a",max:1,"show-file-list":!1,onChange:z},{default:i(()=>[n(o(W),{type:"info"},{default:i(()=>u[4]||(u[4]=[$("上传音频文件")])),_:1})]),_:1})]),_:1}),n(o(T),{label:" ",style:{color:"#b7b7b7","font-size":"12px","margin-top":"-20px"}},{default:i(()=>u[5]||(u[5]=[$(" 声道数：单/双声道"),s("br",null,null,-1),$(" 采样率：大于等于 16000 Hz"),s("br",null,null,-1),$(" 格式：WAV（16bit）、MP3、M4A"),s("br",null,null,-1),$(" 文件大小：10MB 以内"),s("br",null,null,-1),$(" 音频时长：10～20秒，不建议超过60秒。在朗读时请保持连贯，至少包含一段超过5秒的连续语音。"),s("br",null,null,-1)])),_:1}),b.value.voiceSrcUrl?(C(),I("div",zt,[n(o(T),{label:"原音试听"},{default:i(()=>[s("audio",{src:b.value.voiceSrcUrl,controls:"",style:{height:"30px"}},null,8,Vt)]),_:1})])):L("",!0)]),_:1},8,["model"])]),_:1},8,["show"]),g.cloning?(C(),I("div",Ft,[n(o(st),{type:"line",percentage:g.progress,processing:g.progress<100,"indicator-placement":"inside"},{default:i(()=>u[8]||(u[8]=[s("span",null,"声音复刻中...",-1)])),_:1},8,["percentage","processing"])])):L("",!0)]),s("div",Nt,[s("div",It,[n(o(W),{type:"info",onClick:u[3]||(u[3]=S=>_.value=!0)},{default:i(()=>u[9]||(u[9]=[$("复刻声音")])),_:1})]),n(o(Ce),{bordered:!1,"single-line":!1,style:D},{default:i(()=>[u[12]||(u[12]=s("thead",null,[s("tr",null,[s("th",null,"声音名称"),s("th",null,"试听"),s("th",null,"创建时间"),s("th",null,"操作")])],-1)),s("tbody",null,[f.value.length===0?(C(),I("tr",Dt,u[10]||(u[10]=[s("td",{colspan:"4",style:{"text-align":"center",padding:"20px"}},"暂无复刻声音",-1)]))):(C(!0),I(Q,{key:1},ke(f.value,S=>(C(),I("tr",{key:S.id},[s("td",null,J(S.name),1),s("td",null,[s("audio",{src:S.voiceSrcUrl,controls:""},null,8,Pt)]),s("td",null,J(S.createTime),1),s("td",null,[n(o(W),{text:"",onClick:l=>P(S),class:"action-btn"},{default:i(()=>u[11]||(u[11]=[$("删除")])),_:2},1032,["onClick"])])]))),128))])]),_:1})])],64))}},Wt=oe(Lt,[["__scopeId","data-v-2068df77"]]);const Ot={key:0},At=["onClick"],qt=["onClick"],Et={__name:"MemoryManagement",setup(a){let c=null;const{showToast:m,closeWatch:w}=we(),p=_e(),v=ie(),_=k(null),h=X(()=>p.query.userFriendId),f=k({isSupportMemory:0}),r=k(!1),b=k({id:"",memory:""}),x={"--n-border-radius":"0px","--n-td-text-color":"var(--tp_textcolor)","--n-th-text-color":"var(--tp_textcolor)","--n-td-color":"var(--tp_footer_bgcolor)","--n-th-color":"var(--tp_footer_bgcolor)","--n-merged-border-color":"var(--tp_aside_border_color)"},y=k([]),z=l=>{r.value=!0,b.value={id:l.id,memory:l.memory}},B=()=>{r.value=!1,b.value={}},P=()=>U(this,null,function*(){b&&N({url:"/friend/memory/update",method:"POST",data:{memoryId:b.value.id,updatedMemory:b.value.memory}}).then(()=>{v.success("修改成功"),r.value=!1,u()}).catch(l=>{var e;v.error(((e=l.response)==null?void 0:e.data)||"修改失败")})}),V=l=>U(this,null,function*(){c=l,window.__talkx_event_stop=!0,m("del","确定要删除该记忆吗？")}),D=l=>U(this,null,function*(){var e;if(!l){c=null;return}if(c)try{yield N({url:"/friend/memory/delete",method:"POST",data:{memoryId:c.id}}),v.success("删除成功"),yield u()}catch(t){v.error(((e=t.response)==null?void 0:e.data)||"删除失败")}finally{c=null}}),g=()=>U(this,null,function*(){try{const l=yield lt({userFriendId:h.value}),{isSupportMemory:e}=l;f.value.isSupportMemory=e}catch(l){v.error("获取配置失败")}}),u=()=>U(this,null,function*(){var l;try{const e=yield N({url:"/friend/memory/list",method:"get",params:{userFriendId:h.value}});y.value=e.results||[]}catch(e){v.error(((l=e.response)==null?void 0:l.data)||"获取失败")}}),S=()=>U(this,null,function*(){var l;try{yield at({id:h.value,isSupportMemory:f.value.isSupportMemory}),v.success("保存成功")}catch(e){v.error(((l=e.response)==null?void 0:l.data)||"保存失败"),g()}});return g(),u(),w("del",D),(l,e)=>(C(),I(Q,null,[n(o(le),{class:"formComp",ref_key:"formRef",ref:_,model:f.value,"label-placement":"left","label-width":112,"require-mark-placement":"right-hanging",size:"medium"},{default:i(()=>[n(o(T),{label:"是否开启记忆"},{default:i(()=>[n(o(Z),null,{default:i(()=>[n(o(ne),{value:f.value.isSupportMemory,"onUpdate:value":[e[0]||(e[0]=t=>f.value.isSupportMemory=t),S],"checked-value":1,"unchecked-value":0},null,8,["value"])]),_:1})]),_:1}),f.value.isSupportMemory==0?(C(),A(o(T),{key:0,label:" ",style:{color:"#b7b7b7","font-size":"12px","margin-top":"-20px"}},{default:i(()=>e[3]||(e[3]=[$(" 开启后，你与AI的对话过程中会自动产生记忆，这能够提高对话质量，但是响应速度会受到一定的影响。 ")])),_:1})):L("",!0),f.value.isSupportMemory==1?(C(),A(o(T),{key:1,label:" ",style:{color:"#b7b7b7","font-size":"12px","margin-top":"-20px"}},{default:i(()=>e[4]||(e[4]=[$(" 关闭后，现有记忆不会被删除，但也不会使用。这能够提高响应速度，但是对话质量会受到一定的影响。 ")])),_:1})):L("",!0),f.value.isSupportMemory==1?(C(),A(o(Ce),{key:2,bordered:!1,"single-line":!1,style:x},{default:i(()=>[e[6]||(e[6]=s("thead",null,[s("tr",null,[s("th",null,"关于你的信息，AI所产生记忆"),s("th",{width:"70px"},"操作")])],-1)),s("tbody",null,[y.value.length===0?(C(),I("tr",Ot,e[5]||(e[5]=[s("td",{colspan:"2",style:{"text-align":"center",padding:"20px"}},"暂时还没有记忆",-1)]))):(C(!0),I(Q,{key:1},ke(y.value,t=>(C(),I("tr",{key:t.id},[s("td",null,J(t.memory),1),s("td",null,[s("span",{class:"update-btn",onClick:d=>z(t)},"修改",8,At),s("span",{class:"delete-btn",onClick:d=>V(t)},"删除",8,qt)])]))),128))])]),_:1})):L("",!0)]),_:1},8,["model"]),n(o(Se),{show:r.value,"onUpdate:show":e[2]||(e[2]=t=>r.value=t),preset:"dialog",title:"修改记忆内容",closable:!1,"show-icon":!1,"transform-origin":"center"},{action:i(()=>[n(o(Z),null,{default:i(()=>[n(o(W),{quaternary:"",onClick:B},{default:i(()=>e[7]||(e[7]=[$("取消")])),_:1}),n(o(W),{type:"info",loading:l.loading,onClick:P},{default:i(()=>e[8]||(e[8]=[$("确认")])),_:1},8,["loading"])]),_:1})]),default:i(()=>[n(o(le),{ref_key:"formRef",ref:_,model:b.value,rules:l.rules,"label-placement":"left","label-width":80,"require-mark-placement":"right-hanging"},{default:i(()=>[n(o(ae),{type:"textarea",value:b.value.memory,"onUpdate:value":e[1]||(e[1]=t=>b.value.memory=t),placeholder:"输入记忆内容",maxlength:"255"},null,8,["value"])]),_:1},8,["model","rules"])]),_:1},8,["show"])],64))}},Kt=oe(Et,[["__scopeId","data-v-582a9200"]]);const Gt={class:"Device"},Ht={class:"content"},jt={__name:"index",setup(a){return(c,m)=>(C(),I("div",Gt,[s("div",Ht,[n(o(ot),{title:"智体",bordered:!1,style:{"margin-bottom":"16px","background-color":"transparent",color:"var(--tp_avatar_color)"}},{default:i(()=>[n(o(rt),{type:"line",animated:"","pane-wrapper-class":"talkx-pane-wrapper"},{default:i(()=>[n(o(re),{name:"device",tab:"管理设备"},{default:i(()=>[n(Mt)]),_:1}),n(o(re),{name:"voice",tab:"我的声音"},{default:i(()=>[n(Wt)]),_:1}),n(o(re),{name:"audio",tab:"智体设置"},{default:i(()=>[n(Rt)]),_:1}),n(o(re),{name:"memory",tab:"记忆"},{default:i(()=>[n(Kt)]),_:1})]),_:1})]),_:1})])]))}},rl=oe(jt,[["__scopeId","data-v-a8969585"]]);export{rl as default};
